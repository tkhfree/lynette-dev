# NDN 与 GeoNetworking 部署场景对比总结

本文档总结了 NDN 和 GeoNetworking 两个协议的核心部署要求和场景特点。

---

## 📋 快速对比

| 维度 | NDN 网络 | GeoNetworking 车联网 |
|------|----------|---------------------|
| **终端类型** | 固定终端（Consumer/Producer） | 移动终端（车载OBU） |
| **是否需要缓存** | ✅ **必须配置**（核心机制） | ⚠️ 可选（主要用于位置表） |
| **网络连接** | 有线以太网 | 无线 ITS-G5 (802.11p) |
| **是否需要基站** | ❌ 不需要（直连交换机） | ✅ **必须部署**（专用 RSU） |
| **移动性** | 静态或低速 | 高速移动（最高 250 km/h） |
| **典型延迟** | 10-100 ms | < 10 ms（安全关键） |

---

## 🔵 NDN 网络部署要求

### Consumer（消费者）终端

#### ✅ 必须配置本地缓存

**原因：**
- NDN 的核心思想是"网络内缓存"
- 本地缓存可提升 10-25 倍性能
- 减少网络流量和延迟

**配置方式：**

```bash
# 方式 1: NFD 本地缓存（推荐）
nfd-start
nfdc cs config capacity 1000  # 缓存 1000 个 Data 包

# 方式 2: 应用层缓存
# 见 README 中的 Python 示例代码
```

**缓存效果：**
- 第一次访问: 100 ms (网络)
- 第二次访问: 4 ms (缓存) ← **25倍加速！**

#### 硬件要求
- **最低**: ARM 双核 + 512MB RAM
- **推荐**: x86 四核 + 2GB RAM
- **网络**: 100Mbps 以太网（有线）

#### 连接方式
```
Consumer [有线以太网] ←→ NDN Switch (P4)
```

---

### Producer（生产者）服务端

#### ✅ 必须配置大容量缓存服务

**原因：**
- Producer 是内容源，需要缓存热点内容
- 大容量缓存减少磁盘 I/O
- 提升并发处理能力

**配置方式：**

```bash
# 1. NFD 大容量缓存
nfdc cs config capacity 100000  # 10万个包

# 2. 内容仓库服务（持久化）
ndn-repo-ng /etc/ndn/repo.conf

# 3. 分层缓存架构
L1: 热点内存缓存 (1000个) ← 最快
L2: NFD CS (100000个)
L3: Repo SSD (数GB)
L4: 冷存储 HDD (数TB)
```

**缓存策略：**
- 基于访问频率识别热点
- LRU 替换算法
- 内容预热（启动时）

#### 硬件要求
- **最低**: x86 四核 + 2GB RAM + 100GB SSD
- **推荐**: x86 八核 + 8GB RAM + 500GB SSD
- **网络**: 1-10 Gbps 以太网

#### 连接方式
```
Producer [有线以太网] ←→ NDN Switch (P4)
```

---

### NDN 网络部署架构

```
Consumer1 ────┐
Consumer2 ────┼──→ [NDN Switch 1] ───┐
Consumer3 ────┘         (P4)         │
                                     │ 10Gbps
                                     │ 有线
                                     │
                    [NDN Switch 2] ←─┘
                         (P4)
                          │
                          │ 1Gbps
                          │
                      Producer
                   (缓存服务器)
```

**关键特点：**
- ✅ 全部有线连接
- ✅ 固定位置设备
- ✅ 缓存是核心功能
- ❌ 不需要无线基站
- ❌ 不支持高速移动

---

## 🔴 GeoNetworking 车联网部署要求

### OBU（车载单元）终端

#### ✅ 必须支持高速移动

**原因：**
- 车辆时速可达 60-120 km/h
- 需要频繁切换 RSU
- 位置快速更新（10 Hz）

**移动性配置：**

```python
# 基于速度的自适应配置
if speed < 30 km/h:
    cam_interval = 500 ms  # 低速，降低频率
elif speed < 80 km/h:
    cam_interval = 100 ms  # 中速，标准频率
else:
    cam_interval = 100 ms  # 高速，高频定位
    gnss_update = 20 Hz    # 更快的 GPS 更新
```

**切换管理：**
- 监控信号强度（RSSI）
- 阈值触发切换（-80 dBm）
- 无缝切换到新 RSU

#### 硬件要求
- **最低**: ARM 双核 + 1GB RAM
- **推荐**: ARM 四核 + 4GB RAM
- **V2X**: ITS-G5 (802.11p) 无线模块 ← **必须**
- **GNSS**: GPS/北斗 双频 ← **必须**
- **CAN**: 连接车辆总线 ← **必须**

#### 连接方式
```
OBU [无线 ITS-G5] ←→ RSU (路边单元)
     5.9 GHz
    300米范围
```

---

### RSU（路边单元）基站

#### ✅ 必须部署专用无线基站

**原因：**
- 车辆高速移动，需要低延迟（< 10ms）
- 安全关键应用，不能使用普通 Wi-Fi/4G
- 需要支持地理位置路由

**为什么不能用 Wi-Fi/4G/5G？**

| 要求 | ITS-G5 | Wi-Fi | 4G/5G |
|------|--------|-------|-------|
| 延迟 | < 10ms ✅ | 50-100ms ❌ | 50-200ms ❌ |
| 120km/h | 稳定 ✅ | 不稳定 ❌ | 需切换 ⚠️ |
| 广播 | 原生支持 ✅ | 效率低 ❌ | 不支持 ❌ |
| 地理路由 | 原生支持 ✅ | 不支持 ❌ | 不支持 ❌ |

**RSU 部署密度：**

```
路口场景:
     RSU-北 (300m)
        |
  RSU-西—RSU-中心—RSU-东
        |
     RSU-南

部署要求:
- 路口: 5 个 RSU（1中心+4方向）
- 道路: 每 300-500m 一个
- 隧道: 每 200m 一个
- 高速: 每 500m-1km 一个
```

**覆盖范围计算：**
```python
# RSU 发射功率 33 dBm (2W)
# OBU 接收灵敏度 -85 dBm
# 城市环境 → 有效范围约 300-500m
```

#### 硬件要求
- **最低**: x86 四核 + 4GB RAM
- **推荐**: x86 八核 + 16GB RAM
- **V2X**: ITS-G5 多天线 (4-8根) ← **必须**
- **GNSS**: RTK 级精度 (< 10cm) ← **必须**
- **P4**: Barefoot Tofino 交换芯片 ← **必须**
- **回程**: 光纤/4G/5G (连接交通中心)

#### RSU 系统架构
```
┌─────────────────────┐
│  天线阵列 (ITS-G5)  │  ← 360°覆盖
└──────────┬──────────┘
           │
┌──────────▼──────────┐
│  802.11p MAC 层     │  ← 低延迟接入
└──────────┬──────────┘
           │
┌──────────▼──────────┐
│  P4 交换芯片        │  ← GeoNetworking
│  (地理位置路由)     │     (本项目核心)
└──────────┬──────────┘
           │
┌──────────▼──────────┐
│  Linux 控制平面     │  ← SPAT/MAP
└─────────────────────┘
```

---

### GeoNetworking 部署架构

```
     OBU-1 (车辆1)
        |  无线
        |  ITS-G5
    [RSU-北] ────────┐
     (基站)          │
        |            │ 有线
     OBU-2          │ 10Gbps
        |            │
    [RSU-中心] ──────┤
     (P4+基站)       │
        |            │
     OBU-3          │
        |            │
    [RSU-南] ────────┘
     (基站)
        |
     OBU-4
```

**关键特点：**
- ✅ 无线通信（OBU ↔ RSU）
- ✅ 高速移动支持（< 250 km/h）
- ✅ 必须部署专用基站（RSU）
- ✅ 地理位置感知
- ⚠️ 缓存不是核心（主要用于位置表）

---

## 💰 部署成本对比

### NDN 网络

| 设备 | 数量 | 单价 | 小计 |
|------|------|------|------|
| Consumer 终端 | 10 | ¥2,000 | ¥20,000 |
| Producer 服务器 | 2 | ¥20,000 | ¥40,000 |
| P4 交换机 (BMv2 软件) | 3 | ¥0 | ¥0 |
| 网线+交换机 | - | ¥5,000 | ¥5,000 |
| **总计** | - | - | **¥65,000** |

### GeoNetworking 车联网

| 设备 | 数量 | 单价 | 小计 |
|------|------|------|------|
| OBU 车载终端 | 10 | ¥5,000 | ¥50,000 |
| RSU 路边基站 | 5 | ¥50,000 | ¥250,000 |
| P4 交换芯片 (Tofino) | 5 | ¥100,000 | ¥500,000 |
| 安装+供电+网络 | - | ¥50,000 | ¥50,000 |
| **总计** | - | - | **¥850,000** |

**结论：** GeoNetworking 部署成本约为 NDN 的 **13 倍**，主要因为：
1. 需要专用 V2X 通信模块
2. 需要密集部署路边基站
3. 需要高性能 P4 交换芯片

---

## 🎯 应用场景选择建议

### 选择 NDN 网络的场景

✅ **适合：**
- 内容分发网络（CDN）
- 视频点播服务
- 大文件分发
- 边缘计算
- 固定位置的 IoT 设备

❌ **不适合：**
- 车联网、移动场景
- 实时性要求极高（< 10ms）
- 需要地理位置路由

### 选择 GeoNetworking 的场景

✅ **适合：**
- 车联网（V2X）
- 自动驾驶辅助
- 交通安全应用
- 智能交通系统
- 高速移动通信

❌ **不适合：**
- 固定网络
- 内容分发
- 不需要地理位置的应用

---

## 📝 关键配置清单

### NDN 部署清单

```bash
# Consumer 配置
□ 安装 ndn-cxx 和 NFD
□ 配置本地缓存 (capacity >= 1000)
□ 配置 Face 连接到交换机
□ 添加前缀路由

# Producer 配置
□ 安装 ndn-cxx, NFD, Repo
□ 配置大容量缓存 (capacity >= 100000)
□ 配置内容仓库服务
□ 实现分层缓存策略
□ 内容预热

# P4 交换机配置
□ 编译 NDN P4 程序
□ 配置 CS, PIT, FIB 表
□ 启动交换机
□ 测试转发功能
```

### GeoNetworking 部署清单

```bash
# OBU 配置
□ 安装 Vanetza (GeoNetworking 协议栈)
□ 配置 GPS/北斗模块
□ 配置 ITS-G5 无线模块
□ 连接 CAN 总线
□ 配置移动性管理
□ 实现 CAM/DENM 应用

# RSU 配置
□ 安装天线阵列（360°覆盖）
□ 配置 RTK GPS (精度 < 10cm)
□ 编译 GeoNetworking P4 程序
□ 配置位置表和邻居信息
□ 配置 SPAT/MAP 广播
□ 连接回程网络

# 现场部署
□ 确定 RSU 安装位置
□ 计算覆盖范围
□ 布线和供电
□ 信号测试
□ 切换测试
```

---

## 🔬 测试验证

### NDN 网络测试

```bash
# 1. 基本连通性
ndnping /ndn/edu/ucla

# 2. 缓存效果
time ndncatchunks /ndn/video  # 第一次
time ndncatchunks /ndn/video  # 第二次（应该更快）

# 3. 缓存统计
nfdc cs info
```

### GeoNetworking 测试

```bash
# 1. 无线连接测试
iwconfig wlan0
iwlist wlan0 scan

# 2. GPS 定位测试
gpspipe -w -n 10

# 3. CAM 发送测试
vanetza-cam-sender --rate 10

# 4. 移动性测试
./simulate_obu.sh --speed 120 --duration 300

# 5. RSU 切换测试
./test_handover.sh
```

---

## 📚 参考文档

### NDN
- 详细配置: `input/NDN_example/README.md`
- 快速开始: `input/NDN_example/quick_start.sh`
- 协议规范: NFD Developer's Guide

### GeoNetworking
- 详细配置: `input/GEO_example/README.md`
- 快速参考: `input/GEO_example/QUICK_REFERENCE.md`
- 协议规范: ETSI EN 302 636

### 对比分析
- 全面对比: `input/EXAMPLES_COMPARISON.md`

---

## 🎉 总结

| 问题 | NDN 答案 | GeoNetworking 答案 |
|------|---------|-------------------|
| **需要配置缓存吗？** | ✅ **必须** (Consumer + Producer) | ⚠️ 可选（主要是位置表） |
| **需要移动终端吗？** | ❌ 固定终端即可 | ✅ **必须**（车载 OBU） |
| **需要无线基站吗？** | ❌ 不需要 | ✅ **必须**（ITS-G5 RSU） |
| **部署难度** | 较低 | 高 |
| **部署成本** | 较低（~6.5万） | 高（~85万） |
| **适用场景** | 内容分发、固定网络 | 车联网、移动场景 |

**记住：**
- NDN = 缓存为王 + 有线连接 + 固定终端
- GeoNetworking = 移动为王 + 无线基站 + 专用硬件

